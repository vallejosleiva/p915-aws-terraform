---
- name: "Provision Bastion Host"
  hosts: all
  remote_user: ubuntu
  become: yes
  become_user: root
  gather_facts: no
  vars:
    vpn_domain_name: "{{ play_hosts[0] }}"
    ansible_ssh_user: ubuntu
  pre_tasks:
    - name: "Check if python is installed, otherwise install it"
      raw: "test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)"
    - shell: "wget -O - https://swupdate.openvpn.net/repos/repo-public.gpg|apt-key add -"
    - command: "touch /etc/apt/sources.list.d/openvpn-aptrepo.list"
    - shell: "echo \"deb http://build.openvpn.net/debian/openvpn/release/2.4 trusty main\" > /etc/apt/sources.list.d/openvpn-aptrepo.list"
    - group: name=developers state=present system=yes
    - user: name=javier password=$6$rounds=656000$nBTwXwwKjmSMYMrt$AcaMrZHLHZVP2Dm62.48M4gOpGj3eOJn3Rk/RmbFKLyv0vuRGD2UM/DypyYPOMmd54E9yZmjM3UCrtNv3AIx41 groups=sudo,developers shell=/bin/bash
    - apt: update_cache=yes
  roles:
    - openvpn